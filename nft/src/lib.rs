/*!
Non-Fungible Token implementation with JSON serialization.
NOTES:
  - The maximum balance value is limited by U128 (2**128 - 1).
  - JSON calls should pass U128 as a base-10 string. E.g. "100".
  - The contract optimizes the inner trie structure by hashing account IDs. It will prevent some
    abuse of deep tries. Shouldn't be an issue, once NEAR clients implement full hashing of keys.
  - The contract tracks the change in storage before and after the call. If the storage increases,
    the contract requires the caller of the contract to attach enough deposit to the function call
    to cover the storage cost.
    This is done to prevent a denial of service attack on the contract by taking all available storage.
    If the storage decreases, the contract will issue a refund for the cost of the released storage.
    The unused tokens from the attached deposit are also refunded, so it's safe to
    attach more deposit than required.
  - To prevent the deployed contract from being modified or deleted, it should not have any access
    keys on its account.
*/
use near_contract_standards::non_fungible_token::metadata::{
    NFTContractMetadata, NonFungibleTokenMetadataProvider, TokenMetadata, NFT_METADATA_SPEC,
};
use near_contract_standards::non_fungible_token::NonFungibleToken;
use near_contract_standards::non_fungible_token::{Token, TokenId};
use near_contract_standards::fungible_token::metadata::{FungibleTokenMetadata, FT_METADATA_SPEC};
use near_sdk::borsh::{self, BorshDeserialize, BorshSerialize};
use near_sdk::collections::LazyOption;
use near_sdk::json_types::U128;
use near_sdk::{
    env, near_bindgen, require, AccountId, BorshStorageKey, PanicOnDefault, Promise, PromiseOrValue, PromiseError, ext_contract, log, Gas,
};
use near_sdk::serde_json::json;

#[near_bindgen]
#[derive(BorshDeserialize, BorshSerialize, PanicOnDefault)]
pub struct Contract {
    // The tokens
    tokens: NonFungibleToken,

    // The contract metadata
    metadata: LazyOption<NFTContractMetadata>,

    // The counter for auto-incrementing the token id
    token_id_counter: u64,
}

const DATA_IMAGE_SVG: &str = "data:image/svg+xml,%3Csvg id='svg' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' width='400' height='400' viewBox='0, 0, 400,400'%3E%3Cg id='svgg'%3E%3Cpath id='path0' d='M0.000 200.000 L 0.000 400.000 200.000 400.000 L 400.000 400.000 400.000 200.000 L 400.000 0.000 200.000 0.000 L 0.000 0.000 0.000 200.000 M162.000 79.351 C 163.512 80.430,167.000 82.941,169.750 84.932 C 172.500 86.923,176.213 89.602,178.000 90.887 C 190.706 100.017,189.221 97.906,189.333 107.000 C 189.428 114.649,189.423 114.623,190.864 115.925 C 192.368 117.283,192.119 117.250,200.750 117.250 C 209.492 117.250,209.502 117.249,210.868 116.021 C 212.483 114.568,212.496 114.501,212.498 107.680 C 212.501 98.209,211.621 99.679,221.417 92.777 C 223.088 91.599,229.913 86.775,233.250 84.411 C 239.544 79.955,243.107 77.455,243.351 77.324 C 243.704 77.135,243.451 76.814,247.837 83.000 C 252.626 89.754,256.674 95.450,257.695 96.872 C 258.138 97.490,258.500 98.065,258.500 98.151 C 258.500 98.359,253.346 102.042,253.023 102.065 C 252.786 102.082,251.272 100.018,244.968 91.083 C 243.674 89.250,242.590 87.719,242.559 87.682 C 242.505 87.617,241.156 88.503,238.500 90.346 C 234.535 93.099,232.451 94.544,231.404 95.268 C 230.755 95.716,227.999 97.621,225.280 99.500 L 220.335 102.917 220.376 131.667 L 220.417 160.417 220.810 161.583 C 221.487 163.587,224.048 167.781,225.179 168.737 C 226.474 169.831,228.167 170.217,229.707 169.770 C 230.861 169.434,238.324 163.939,239.961 162.220 C 242.240 159.826,243.459 155.509,242.664 152.648 C 242.572 152.317,242.352 151.380,242.175 150.565 C 241.998 149.750,241.508 147.583,241.087 145.750 C 240.187 141.834,239.274 137.822,238.829 135.833 C 238.654 135.054,238.170 132.917,237.752 131.083 C 237.334 129.250,236.869 127.206,236.720 126.542 L 236.449 125.333 232.388 125.333 L 228.327 125.333 228.372 121.458 L 228.417 117.583 234.474 117.540 C 241.083 117.492,241.481 117.534,242.447 118.382 C 243.505 119.312,243.378 118.842,245.750 130.583 C 246.250 133.058,247.151 137.483,247.752 140.417 C 248.353 143.350,249.102 147.025,249.417 148.583 C 249.731 150.142,250.377 153.292,250.853 155.583 C 252.060 161.396,251.994 162.809,250.462 164.011 C 249.349 164.885,244.103 168.877,239.417 172.416 C 231.953 178.053,231.753 178.207,231.698 178.346 C 231.670 178.418,232.203 179.289,232.884 180.280 C 235.786 184.509,238.999 189.210,240.083 190.814 L 241.250 192.540 241.250 193.839 C 241.250 195.909,241.796 195.417,228.172 205.625 C 215.807 214.890,215.800 214.894,215.506 214.344 C 215.308 213.974,215.266 205.360,215.461 205.063 C 215.573 204.892,217.764 203.295,226.833 196.774 C 228.621 195.489,230.621 194.051,231.278 193.578 L 232.472 192.718 228.997 187.651 C 227.086 184.864,224.637 181.289,223.553 179.707 C 221.487 176.691,218.545 172.404,216.033 168.750 C 212.668 163.855,212.945 165.815,212.839 146.167 L 212.750 129.750 212.285 128.804 C 211.616 127.442,210.147 126.132,208.778 125.676 C 207.109 125.121,194.355 125.212,193.118 125.789 C 192.011 126.304,190.651 127.644,190.070 128.789 L 189.583 129.750 189.486 145.833 C 189.425 155.857,189.325 162.180,189.219 162.614 C 188.732 164.609,188.154 165.583,181.662 175.333 C 169.927 192.959,170.112 192.672,170.393 192.889 C 170.749 193.164,182.840 202.313,184.974 203.922 L 186.750 205.260 186.750 209.838 C 186.750 214.415,186.750 214.417,186.387 214.468 C 186.023 214.520,185.417 214.083,178.250 208.597 C 176.692 207.404,173.467 204.942,171.083 203.126 C 157.854 193.046,158.395 194.967,165.880 184.650 C 168.567 180.947,170.819 177.828,170.885 177.720 C 170.964 177.591,167.663 175.096,161.341 170.503 C 151.371 163.260,150.662 162.670,150.246 161.269 C 149.844 159.916,149.881 159.555,150.912 154.750 C 151.148 153.650,151.448 152.225,151.579 151.583 C 151.709 150.942,152.011 149.517,152.250 148.417 C 152.489 147.317,153.098 144.467,153.605 142.083 C 154.111 139.700,154.709 136.887,154.933 135.833 C 155.158 134.779,155.448 133.392,155.579 132.750 C 155.709 132.108,156.011 130.683,156.250 129.583 C 156.489 128.483,156.753 127.246,156.837 126.833 C 158.929 116.606,157.846 117.601,166.958 117.535 L 173.667 117.486 173.667 121.410 L 173.667 125.333 169.693 125.333 L 165.720 125.333 165.531 126.208 C 164.841 129.397,162.437 140.334,162.169 141.500 C 161.989 142.279,161.650 143.817,161.414 144.917 C 161.179 146.017,160.696 148.229,160.341 149.833 C 159.000 155.903,159.667 159.439,162.687 162.280 C 163.796 163.324,171.265 169.010,172.000 169.370 C 174.572 170.632,176.679 169.728,179.164 166.296 C 182.462 161.742,182.167 165.184,182.167 131.335 L 182.167 102.889 180.958 102.060 C 180.294 101.604,175.377 98.212,170.032 94.523 C 164.686 90.834,160.224 87.785,160.115 87.748 C 159.940 87.689,158.498 89.667,151.325 99.804 C 150.112 101.517,149.565 102.163,149.384 102.094 C 148.936 101.922,144.132 98.436,144.050 98.223 C 143.975 98.028,144.969 96.584,151.000 88.127 C 152.421 86.134,154.367 83.396,155.324 82.043 C 158.360 77.752,158.832 77.147,159.047 77.272 C 159.159 77.337,160.487 78.272,162.000 79.351 M188.852 181.717 C 189.162 181.929,191.347 183.507,193.707 185.226 C 200.439 190.129,201.202 190.239,205.783 186.965 C 206.718 186.297,207.803 185.525,208.195 185.250 C 213.920 181.229,213.925 181.225,214.531 181.708 C 215.140 182.195,218.167 186.737,218.167 187.165 C 218.167 187.765,218.278 187.673,210.823 193.248 C 202.356 199.580,201.950 199.765,198.756 198.720 C 198.050 198.489,185.730 189.469,184.042 187.947 C 183.404 187.372,183.566 186.912,185.363 184.205 C 187.446 181.068,187.666 180.911,188.852 181.717 M63.074 249.375 C 63.109 249.490,63.337 250.333,63.582 251.250 C 63.827 252.167,64.126 253.254,64.248 253.667 C 64.369 254.079,64.669 255.167,64.914 256.083 C 65.160 257.000,65.460 258.087,65.581 258.500 C 65.703 258.912,66.003 260.000,66.248 260.917 C 66.493 261.833,66.793 262.921,66.914 263.333 C 67.036 263.746,67.336 264.833,67.581 265.750 C 67.826 266.667,68.126 267.754,68.247 268.167 C 68.538 269.158,69.422 272.346,69.726 273.500 C 69.858 274.004,70.358 275.804,70.837 277.500 C 71.315 279.196,71.764 280.808,71.835 281.083 C 71.905 281.358,72.204 282.446,72.500 283.500 C 72.796 284.554,73.096 285.642,73.167 285.917 C 73.238 286.192,73.538 287.279,73.833 288.333 C 74.129 289.387,74.429 290.475,74.500 290.750 C 74.571 291.025,74.872 292.112,75.168 293.167 C 75.465 294.221,75.762 295.308,75.829 295.583 C 75.970 296.161,75.893 296.380,76.489 293.708 C 76.679 292.860,76.981 291.510,77.162 290.708 C 77.343 289.906,77.683 288.350,77.919 287.250 C 78.552 284.293,79.467 280.113,79.834 278.500 C 80.012 277.721,80.348 276.183,80.581 275.083 C 80.814 273.983,81.077 272.783,81.167 272.417 C 81.256 272.050,81.519 270.850,81.752 269.750 C 81.986 268.650,82.324 267.094,82.505 266.292 C 82.685 265.490,82.981 264.177,83.162 263.375 C 83.456 262.068,83.690 260.986,84.609 256.667 C 85.378 253.055,85.774 252.090,86.945 250.975 C 89.264 248.767,92.877 248.688,95.469 250.790 C 96.938 251.981,97.102 252.463,98.917 260.917 C 99.536 263.798,100.258 267.088,100.828 269.625 C 101.242 271.469,102.191 275.812,102.748 278.417 C 102.984 279.517,103.324 281.073,103.505 281.875 C 104.264 285.247,104.888 288.087,105.417 290.583 C 105.650 291.683,105.989 293.199,106.171 293.952 C 106.352 294.705,106.500 295.486,106.500 295.688 C 106.500 296.492,106.620 296.117,108.240 290.250 C 108.671 288.692,109.123 287.079,109.246 286.667 C 109.369 286.254,109.669 285.167,109.914 284.250 C 110.160 283.333,110.460 282.246,110.581 281.833 C 110.703 281.421,111.005 280.333,111.253 279.417 C 111.500 278.500,111.948 276.887,112.248 275.833 C 112.547 274.779,112.995 273.167,113.243 272.250 C 113.491 271.333,113.793 270.246,113.914 269.833 C 114.036 269.421,114.336 268.333,114.581 267.417 C 114.826 266.500,115.126 265.412,115.248 265.000 C 115.370 264.587,115.819 262.975,116.246 261.417 C 116.673 259.858,117.122 258.246,117.243 257.833 C 117.364 257.421,117.621 256.502,117.815 255.792 C 118.288 254.054,118.753 252.373,119.232 250.667 L 119.629 249.250 122.678 249.204 C 126.249 249.151,126.073 249.057,125.590 250.750 C 125.381 251.483,124.857 253.358,124.427 254.917 C 123.996 256.475,123.544 258.087,123.421 258.500 C 123.298 258.912,122.997 260.000,122.752 260.917 C 122.507 261.833,122.207 262.921,122.085 263.333 C 121.963 263.746,121.514 265.358,121.087 266.917 C 120.660 268.475,120.210 270.087,120.088 270.500 C 119.965 270.912,119.662 272.000,119.414 272.917 C 119.166 273.833,118.709 275.483,118.397 276.583 C 117.833 278.578,117.481 279.847,116.815 282.292 C 116.621 283.002,116.364 283.921,116.243 284.333 C 116.122 284.746,115.673 286.358,115.246 287.917 C 114.819 289.475,114.370 291.087,114.248 291.500 C 114.126 291.912,113.825 293.000,113.578 293.917 C 112.341 298.507,111.911 299.410,110.429 300.526 C 108.114 302.268,104.844 302.190,102.503 300.336 C 101.193 299.298,100.930 298.643,99.840 293.708 C 99.653 292.860,99.354 291.510,99.177 290.708 C 98.569 287.971,98.340 286.916,97.915 284.917 C 97.682 283.817,97.345 282.279,97.168 281.500 C 96.800 279.887,95.885 275.707,95.252 272.750 C 95.016 271.650,94.678 270.112,94.500 269.333 C 94.322 268.554,93.985 267.017,93.751 265.917 C 93.323 263.897,93.072 262.748,92.499 260.167 C 92.326 259.387,92.020 258.000,91.821 257.083 C 91.368 255.008,91.302 254.808,91.218 255.250 C 91.183 255.433,91.009 256.221,90.832 257.000 C 90.655 257.779,90.317 259.317,90.081 260.417 C 89.846 261.517,89.391 263.617,89.071 265.083 C 88.521 267.601,88.291 268.637,87.505 272.125 C 87.324 272.927,86.984 274.483,86.748 275.583 C 86.513 276.683,86.058 278.783,85.738 280.250 C 85.188 282.768,84.957 283.804,84.171 287.292 C 83.991 288.094,83.650 289.650,83.415 290.750 C 81.527 299.571,81.198 300.252,78.300 301.352 C 74.155 302.924,70.777 300.710,69.498 295.583 C 69.430 295.308,68.980 293.696,68.500 292.000 C 68.020 290.304,67.569 288.692,67.499 288.417 C 67.429 288.142,67.129 287.054,66.833 286.000 C 66.538 284.946,66.238 283.858,66.168 283.583 C 66.098 283.308,65.647 281.696,65.167 280.000 C 64.686 278.304,64.236 276.692,64.165 276.417 C 64.095 276.142,63.796 275.054,63.500 274.000 C 63.204 272.946,62.904 271.858,62.833 271.583 C 62.762 271.308,62.462 270.221,62.167 269.167 C 61.871 268.112,61.571 267.025,61.501 266.750 C 61.431 266.475,60.980 264.862,60.500 263.167 C 60.020 261.471,59.569 259.858,59.499 259.583 C 59.429 259.308,59.129 258.221,58.833 257.167 C 58.538 256.112,58.238 255.025,58.167 254.750 C 58.096 254.475,57.796 253.387,57.500 252.333 C 56.783 249.778,56.689 249.366,56.797 249.258 C 57.004 249.051,63.009 249.163,63.074 249.375 M178.459 260.876 L 178.502 272.502 191.293 272.459 L 204.083 272.417 204.167 260.833 L 204.250 249.250 207.250 249.250 L 210.250 249.250 210.292 275.542 L 210.334 301.833 207.251 301.833 L 204.167 301.833 204.167 290.167 L 204.167 278.500 191.333 278.500 L 178.500 278.500 178.500 290.167 L 178.500 301.833 175.417 301.833 L 172.333 301.833 172.333 275.611 C 172.333 261.189,172.385 249.337,172.448 249.274 C 172.511 249.211,173.880 249.180,175.490 249.205 L 178.417 249.250 178.459 260.876 M149.855 266.060 C 155.517 267.509,159.408 270.898,162.330 276.925 C 163.693 279.737,163.733 279.379,161.953 280.232 C 161.108 280.637,156.779 282.762,152.333 284.953 C 147.887 287.144,142.731 289.679,140.875 290.586 C 137.044 292.457,137.222 292.273,138.366 293.177 C 144.094 297.705,153.073 295.810,158.287 288.973 C 159.073 287.942,158.900 287.901,161.549 289.753 C 164.337 291.703,164.199 291.387,162.939 292.942 C 154.522 303.324,141.348 304.848,132.917 296.417 C 120.040 283.540,132.301 261.567,149.855 266.060 M240.667 265.985 C 246.036 267.211,250.472 270.740,253.001 275.796 C 254.668 279.129,254.869 281.046,254.801 292.917 L 254.750 301.750 251.708 301.795 L 248.667 301.841 248.667 299.573 L 248.667 297.306 248.208 297.658 C 240.580 303.516,230.995 303.195,224.309 296.857 C 212.967 286.103,219.071 267.826,234.750 265.598 C 235.817 265.446,239.307 265.674,240.667 265.985 M273.221 280.532 L 280.678 295.564 282.319 292.240 C 283.789 289.262,289.192 278.330,293.824 268.958 L 295.534 265.500 298.841 265.500 C 300.659 265.500,302.178 265.556,302.217 265.625 C 302.255 265.694,300.666 269.019,298.685 273.015 C 296.704 277.011,293.034 284.436,290.530 289.515 C 285.572 299.569,285.473 299.747,284.347 300.573 C 282.495 301.933,280.177 302.173,278.142 301.216 C 276.161 300.285,276.131 300.237,271.058 290.018 C 263.109 274.008,259.000 265.682,259.000 265.590 C 259.000 265.540,260.522 265.500,262.382 265.500 L 265.763 265.500 273.221 280.532 M328.589 265.980 C 333.263 267.030,336.768 269.488,339.588 273.691 C 340.397 274.897,342.500 278.962,342.500 279.321 C 342.500 279.427,340.606 280.439,338.292 281.571 C 335.977 282.702,330.671 285.308,326.500 287.362 C 322.329 289.416,318.373 291.356,317.708 291.673 C 316.250 292.369,316.259 292.290,317.539 293.253 C 323.256 297.551,331.234 296.064,336.742 289.675 C 338.316 287.850,337.895 287.838,340.678 289.792 C 343.375 291.685,343.250 291.403,342.048 292.892 C 332.935 304.171,318.022 304.898,310.147 294.447 C 300.190 281.234,312.426 262.346,328.589 265.980 M143.917 271.819 C 138.589 272.483,134.166 277.179,133.747 282.615 C 133.635 284.064,133.870 286.603,134.141 286.874 C 134.215 286.948,137.644 285.348,141.762 283.320 C 145.881 281.291,150.623 278.963,152.302 278.145 L 155.354 276.658 154.832 275.998 C 152.451 272.992,148.043 271.304,143.917 271.819 M234.917 271.820 C 230.187 272.406,225.961 276.333,224.988 281.046 C 222.556 292.832,236.625 300.558,245.083 292.080 C 253.212 283.933,246.418 270.394,234.917 271.820 M322.859 271.838 C 317.130 272.626,312.830 277.639,312.785 283.583 C 312.776 284.871,313.065 287.000,313.250 287.000 C 313.321 287.000,318.977 284.240,327.875 279.862 C 331.427 278.115,334.333 276.639,334.333 276.583 C 334.333 276.375,332.557 274.602,331.743 273.998 C 329.326 272.204,326.028 271.402,322.859 271.838 ' stroke='none' fill='%23040404' fill-rule='evenodd'%3E%3C/path%3E%3Cpath id='path1' d='M157.731 78.799 C 156.447 80.628,149.537 90.346,146.389 94.750 C 145.079 96.583,144.007 98.121,144.008 98.167 C 144.009 98.212,144.648 98.700,145.430 99.250 C 146.211 99.800,147.445 100.680,148.172 101.205 L 149.495 102.159 150.190 101.205 C 151.744 99.069,152.611 97.856,156.169 92.833 C 158.215 89.946,159.909 87.556,159.935 87.523 C 159.960 87.490,160.867 88.078,161.949 88.829 C 163.031 89.580,166.354 91.877,169.333 93.933 C 172.313 95.988,175.371 98.101,176.129 98.627 C 177.780 99.772,179.864 101.213,181.292 102.198 L 182.333 102.917 182.290 131.583 L 182.247 160.250 181.864 161.500 C 180.932 164.533,177.906 168.694,176.000 169.560 C 173.839 170.542,172.520 170.084,168.443 166.935 C 166.870 165.720,164.931 164.223,164.135 163.608 C 160.190 160.565,158.740 156.512,159.841 151.604 C 160.029 150.768,160.326 149.446,160.503 148.667 C 160.679 147.887,161.009 146.387,161.235 145.333 C 161.692 143.199,163.990 132.752,164.515 130.417 C 164.701 129.592,165.023 128.129,165.231 127.167 L 165.610 125.417 169.597 125.333 L 173.583 125.250 173.583 121.500 L 173.583 117.750 167.041 117.706 C 158.205 117.648,158.967 117.190,157.670 123.333 C 157.196 125.579,156.625 128.279,156.400 129.333 C 156.176 130.387,155.885 131.775,155.755 132.417 C 155.624 133.058,155.322 134.483,155.083 135.583 C 154.845 136.683,154.235 139.533,153.729 141.917 C 153.223 144.300,152.625 147.112,152.400 148.167 C 152.176 149.221,151.885 150.608,151.754 151.250 C 151.624 151.892,151.324 153.317,151.088 154.417 C 150.058 159.217,149.982 159.711,150.152 160.504 C 150.568 162.446,150.964 162.855,155.828 166.376 C 159.275 168.871,160.630 169.857,164.250 172.503 C 164.708 172.838,166.455 174.107,168.132 175.323 L 171.181 177.533 170.785 178.058 C 170.568 178.347,169.278 180.121,167.920 182.000 C 166.562 183.879,165.272 185.659,165.053 185.955 C 160.471 192.154,160.163 192.815,160.981 194.695 C 161.403 195.665,161.148 195.454,170.417 202.509 C 174.908 205.928,179.033 209.073,179.583 209.497 C 185.940 214.404,186.520 214.788,186.732 214.236 C 186.877 213.859,186.853 205.618,186.706 205.409 C 186.638 205.312,185.196 204.192,183.500 202.918 C 180.341 200.546,174.950 196.473,171.833 194.104 C 170.871 193.372,170.108 192.694,170.138 192.596 C 170.192 192.425,171.549 190.374,182.687 173.634 C 185.596 169.262,188.131 165.334,188.321 164.906 C 189.298 162.698,189.236 163.844,189.330 146.167 L 189.417 129.917 189.860 128.971 C 191.433 125.615,192.741 125.173,201.117 125.169 C 209.572 125.166,211.151 125.714,212.533 129.133 L 212.917 130.083 213.000 146.500 L 213.083 162.917 213.481 164.000 C 214.106 165.700,214.382 166.170,217.063 170.076 C 218.449 172.097,220.020 174.387,220.553 175.167 C 221.085 175.946,222.422 177.896,223.522 179.500 C 224.623 181.104,226.422 183.729,227.521 185.333 C 228.620 186.938,230.188 189.225,231.007 190.417 C 231.825 191.608,232.496 192.634,232.497 192.696 C 232.500 192.805,231.653 193.426,224.583 198.505 C 222.750 199.822,219.955 201.833,218.372 202.975 L 215.495 205.049 215.539 209.731 C 215.580 214.009,215.608 214.417,215.871 214.468 C 216.155 214.522,239.540 197.121,240.272 196.310 C 241.238 195.241,241.521 193.497,240.918 192.333 C 240.640 191.795,239.581 190.215,236.282 185.417 C 233.384 181.201,231.463 178.315,231.521 178.265 C 231.555 178.235,233.608 176.682,236.084 174.814 C 252.855 162.153,251.418 163.405,251.604 161.296 C 251.674 160.504,251.572 159.642,251.186 157.750 C 250.906 156.375,250.033 152.100,249.248 148.250 C 248.462 144.400,247.562 139.975,247.248 138.417 C 246.397 134.190,243.884 121.885,243.657 120.833 C 243.400 119.640,242.827 118.686,242.059 118.167 L 241.442 117.750 234.971 117.701 L 228.500 117.652 228.500 121.493 L 228.500 125.333 232.494 125.333 L 236.487 125.333 236.661 125.979 C 236.815 126.552,237.935 131.406,238.588 134.333 C 238.721 134.929,238.984 136.092,239.173 136.917 C 239.362 137.742,239.659 139.054,239.832 139.833 C 240.006 140.612,240.492 142.750,240.914 144.583 C 243.288 154.904,243.341 155.342,242.534 157.917 C 241.556 161.034,240.665 162.056,235.544 165.932 C 230.200 169.978,230.309 169.917,228.417 169.917 C 225.957 169.917,225.308 169.463,223.235 166.301 C 220.003 161.370,220.333 165.341,220.333 131.398 L 220.333 102.860 222.208 101.540 C 223.240 100.814,225.171 99.469,226.500 98.551 C 227.829 97.632,229.479 96.491,230.167 96.015 C 230.854 95.539,233.012 94.047,234.962 92.700 C 236.913 91.352,239.386 89.637,240.459 88.889 C 241.531 88.140,242.459 87.558,242.521 87.596 C 242.583 87.634,244.192 89.860,246.098 92.541 C 248.003 95.223,250.325 98.479,251.257 99.778 L 252.951 102.139 255.434 100.387 C 256.799 99.423,258.055 98.536,258.225 98.415 C 258.559 98.177,259.324 99.303,248.252 83.750 C 246.686 81.550,245.050 79.247,244.616 78.633 C 244.183 78.019,243.754 77.471,243.663 77.415 C 243.507 77.318,242.748 77.808,239.500 80.106 C 238.721 80.658,232.796 84.843,226.333 89.406 C 219.871 93.970,214.339 97.936,214.040 98.219 C 212.764 99.431,212.760 99.457,212.667 107.000 L 212.583 113.750 212.169 114.562 C 210.807 117.228,210.257 117.357,200.561 117.298 C 191.267 117.241,191.014 117.176,189.715 114.530 L 189.250 113.583 189.167 106.833 C 189.061 98.243,189.470 99.199,184.333 95.538 C 181.242 93.334,172.468 87.022,167.083 83.129 C 160.958 78.699,159.026 77.334,158.893 77.340 C 158.814 77.344,158.291 78.000,157.731 78.799 M187.454 181.516 C 187.291 181.611,186.410 182.807,185.495 184.174 C 183.707 186.848,183.538 187.342,184.208 187.948 C 185.280 188.917,197.553 198.023,198.336 198.429 C 199.642 199.108,201.959 199.133,203.333 198.484 C 204.111 198.116,216.347 189.144,217.708 187.943 C 218.403 187.330,218.310 187.077,216.359 184.312 L 214.552 181.750 213.901 181.754 C 213.325 181.757,212.714 182.138,208.583 185.072 C 200.716 190.660,201.028 190.661,193.311 185.044 C 187.801 181.035,188.037 181.176,187.454 181.516 M133.539 283.667 C 133.539 283.987,133.573 284.119,133.615 283.958 C 133.657 283.798,133.657 283.535,133.615 283.375 C 133.573 283.215,133.539 283.346,133.539 283.667 ' stroke='none' fill='%2319b6cc' fill-rule='evenodd'%3E%3C/path%3E%3Cpath id='path2' d='M56.833 249.476 C 56.833 249.555,57.053 250.399,57.320 251.351 C 57.588 252.304,58.307 254.883,58.917 257.083 C 59.528 259.283,60.278 261.983,60.584 263.083 C 60.891 264.183,61.566 266.621,62.084 268.500 C 62.934 271.581,63.401 273.262,65.252 279.917 C 65.558 281.017,66.233 283.454,66.751 285.333 C 67.932 289.615,69.212 294.221,69.854 296.500 C 70.866 300.093,72.662 301.577,76.000 301.577 C 79.938 301.577,81.323 300.074,82.498 294.527 C 82.776 293.212,83.718 288.900,84.590 284.943 C 87.209 273.064,89.423 262.991,90.356 258.710 C 90.840 256.488,91.285 254.725,91.345 254.793 C 91.405 254.861,91.838 256.679,92.307 258.833 C 92.777 260.987,93.793 265.637,94.567 269.167 C 95.340 272.696,96.546 278.208,97.248 281.417 C 100.660 297.025,100.869 297.915,101.305 298.726 C 103.375 302.582,109.678 302.605,111.915 298.764 C 112.133 298.390,112.699 296.696,113.172 295.000 C 115.669 286.059,116.078 284.589,116.581 282.750 C 116.881 281.650,117.632 278.950,118.249 276.750 C 118.866 274.550,119.617 271.850,119.917 270.750 C 120.218 269.650,120.967 266.950,121.581 264.750 C 123.938 256.317,124.531 254.182,125.099 252.083 C 125.421 250.892,125.724 249.785,125.770 249.625 C 125.850 249.355,125.631 249.333,122.786 249.333 L 119.715 249.333 119.369 250.542 C 119.178 251.206,118.721 252.838,118.353 254.167 C 117.985 255.496,116.996 259.058,116.156 262.083 C 115.316 265.108,114.383 268.483,114.083 269.583 C 113.782 270.683,113.033 273.383,112.418 275.583 C 111.802 277.783,111.052 280.483,110.750 281.583 C 110.448 282.683,109.900 284.671,109.533 286.000 C 109.166 287.329,108.400 290.104,107.830 292.167 C 107.261 294.229,106.745 296.010,106.683 296.125 C 106.621 296.239,106.175 294.514,105.691 292.291 C 104.867 288.500,103.993 284.516,100.912 270.500 C 100.217 267.337,99.468 263.925,99.249 262.917 C 97.036 252.737,96.976 252.528,95.925 251.364 C 93.727 248.932,89.899 248.690,87.261 250.817 C 86.003 251.832,85.592 252.696,84.928 255.728 C 84.006 259.937,81.250 272.507,79.935 278.500 C 79.160 282.029,77.986 287.392,77.325 290.417 C 76.663 293.442,76.072 295.973,76.010 296.042 C 75.949 296.112,75.541 294.874,75.104 293.292 C 74.668 291.711,74.056 289.517,73.746 288.417 C 73.436 287.317,73.073 286.004,72.940 285.500 C 72.670 284.480,69.881 274.383,69.256 272.167 C 69.037 271.387,68.558 269.662,68.192 268.333 C 66.984 263.941,65.651 259.121,64.922 256.500 C 64.527 255.079,63.919 252.885,63.571 251.625 L 62.938 249.333 59.886 249.333 C 58.207 249.333,56.833 249.398,56.833 249.476 M172.500 275.500 L 172.500 301.667 175.417 301.667 L 178.333 301.667 178.333 290.083 L 178.333 278.500 191.333 278.500 L 204.333 278.500 204.333 290.083 L 204.333 301.667 207.250 301.667 L 210.167 301.667 210.167 275.500 L 210.167 249.333 207.251 249.333 L 204.336 249.333 204.293 260.875 L 204.250 272.417 191.292 272.459 L 178.333 272.502 178.333 260.918 L 178.333 249.333 175.417 249.333 L 172.500 249.333 172.500 275.500 M142.827 265.832 C 128.942 268.049,122.797 284.870,132.008 295.447 C 137.806 302.105,146.954 303.541,155.667 299.161 C 157.718 298.130,160.684 295.539,162.876 292.861 C 164.055 291.422,164.221 291.746,161.250 289.667 L 159.083 288.150 158.501 288.867 C 153.503 295.015,147.060 297.208,141.013 294.818 C 139.808 294.342,137.510 292.815,137.382 292.406 C 137.351 292.309,139.709 291.056,142.621 289.623 C 145.534 288.191,151.364 285.323,155.577 283.252 C 159.790 281.180,163.263 279.459,163.296 279.427 C 163.536 279.186,161.023 274.508,159.688 272.713 C 155.808 267.493,149.231 264.809,142.827 265.832 M233.800 265.835 C 221.868 267.727,215.189 280.760,220.521 291.750 C 225.327 301.659,238.733 304.815,247.458 298.092 L 248.667 297.161 248.667 299.414 L 248.667 301.667 251.667 301.667 L 254.667 301.667 254.667 291.855 C 254.667 283.817,254.621 281.776,254.412 280.563 C 252.766 270.984,243.425 264.309,233.800 265.835 M259.167 265.743 C 259.167 265.785,262.510 272.554,266.596 280.785 C 270.682 289.016,274.413 296.537,274.887 297.499 C 276.394 300.555,277.849 301.583,280.667 301.583 C 283.954 301.583,284.861 300.779,287.402 295.610 C 288.446 293.487,291.640 287.025,294.500 281.250 C 299.427 271.302,302.011 266.071,302.138 265.792 C 302.169 265.723,300.701 265.667,298.876 265.667 L 295.559 265.667 290.343 276.208 C 287.475 282.006,284.146 288.756,282.946 291.208 C 281.747 293.660,280.724 295.666,280.674 295.665 C 280.624 295.665,280.208 294.884,279.750 293.930 C 279.292 292.977,275.954 286.229,272.333 278.935 L 265.750 265.674 262.458 265.670 C 260.648 265.668,259.167 265.701,259.167 265.743 M321.917 265.820 C 307.068 268.222,301.507 286.523,312.481 296.875 C 317.751 301.847,325.270 303.027,332.737 300.053 C 336.446 298.575,338.835 296.618,342.780 291.824 C 342.965 291.598,342.669 291.335,340.559 289.845 L 338.124 288.125 337.687 288.687 C 333.944 293.501,329.909 295.662,324.663 295.665 C 321.502 295.667,316.940 293.843,316.372 292.349 C 316.348 292.285,317.623 291.603,319.205 290.835 C 320.788 290.066,325.871 287.569,330.500 285.287 C 335.129 283.004,339.685 280.764,340.625 280.309 C 342.636 279.335,342.586 279.557,341.356 277.064 C 337.209 268.656,330.037 264.507,321.917 265.820 M149.468 272.212 C 151.701 272.997,155.333 275.682,155.333 276.548 C 155.333 276.678,153.581 277.632,151.208 278.794 C 148.940 279.905,144.241 282.209,140.768 283.915 C 137.294 285.620,134.376 287.031,134.283 287.050 C 133.655 287.174,133.398 282.802,133.915 280.769 C 135.632 274.004,143.013 269.943,149.468 272.212 M239.738 272.007 C 248.042 274.182,251.481 284.404,246.160 291.092 C 238.949 300.154,224.750 295.230,224.750 283.667 C 224.750 275.584,231.965 269.971,239.738 272.007 M327.741 271.998 C 329.788 272.521,331.527 273.529,333.136 275.124 C 334.733 276.707,334.739 276.631,332.949 277.483 C 332.198 277.840,328.508 279.649,324.750 281.502 C 313.970 286.819,313.258 287.158,313.133 287.033 C 312.869 286.769,312.630 284.333,312.720 282.833 C 313.175 275.326,320.394 270.119,327.741 271.998 ' stroke='none' fill='%23fbfbfb' fill-rule='evenodd'%3E%3C/path%3E%3Cpath id='path3' d='M56.775 249.292 C 56.733 249.360,57.609 249.397,58.724 249.373 C 62.523 249.291,62.920 249.232,59.885 249.199 C 58.217 249.181,56.818 249.223,56.775 249.292 M119.558 249.424 C 119.503 249.565,119.506 249.728,119.563 249.785 C 119.620 249.842,119.667 249.761,119.667 249.604 C 119.667 249.344,119.938 249.324,122.818 249.368 C 124.551 249.395,125.934 249.360,125.891 249.292 C 125.723 249.021,119.664 249.147,119.558 249.424 M172.448 249.274 C 172.385 249.337,172.333 261.191,172.333 275.615 L 172.333 301.841 175.375 301.795 L 178.417 301.750 178.418 290.083 L 178.420 278.417 178.376 290.042 L 178.331 301.667 175.416 301.667 L 172.500 301.667 172.500 275.500 L 172.500 249.333 175.416 249.333 L 178.331 249.333 178.376 260.958 L 178.420 272.583 178.418 260.917 L 178.417 249.250 175.490 249.205 C 173.880 249.180,172.511 249.211,172.448 249.274 M204.245 249.371 C 204.200 249.488,204.184 254.683,204.208 260.917 L 204.252 272.250 204.293 260.792 L 204.333 249.333 207.250 249.333 L 210.167 249.333 210.167 275.500 L 210.167 301.667 207.251 301.667 L 204.336 301.667 204.292 290.375 L 204.248 279.083 204.207 290.462 L 204.167 301.841 207.208 301.795 L 210.250 301.750 210.250 275.500 L 210.250 249.250 207.288 249.204 C 205.009 249.169,204.307 249.208,204.245 249.371 M95.333 250.719 C 95.333 250.748,95.577 250.991,95.875 251.260 L 96.417 251.750 95.927 251.208 C 95.471 250.703,95.333 250.590,95.333 250.719 M144.958 265.622 C 145.348 265.657,145.985 265.657,146.375 265.622 C 146.765 265.587,146.446 265.558,145.667 265.558 C 144.887 265.558,144.569 265.587,144.958 265.622 M235.958 265.622 C 236.348 265.657,236.985 265.657,237.375 265.622 C 237.765 265.587,237.446 265.558,236.667 265.558 C 235.887 265.558,235.569 265.587,235.958 265.622 M259.000 265.625 C 259.000 265.694,259.993 265.730,261.208 265.707 C 265.356 265.625,265.752 265.566,262.375 265.533 C 260.519 265.515,259.000 265.556,259.000 265.625 M296.583 265.615 C 299.446 265.734,302.296 265.739,302.225 265.625 C 302.182 265.556,300.633 265.515,298.782 265.533 C 296.931 265.551,295.942 265.588,296.583 265.615 M323.958 265.622 C 324.348 265.657,324.985 265.657,325.375 265.622 C 325.765 265.587,325.446 265.558,324.667 265.558 C 323.887 265.558,323.569 265.587,323.958 265.622 M137.125 267.595 C 136.502 267.933,136.540 268.074,137.167 267.750 C 137.442 267.608,137.667 267.456,137.667 267.412 C 137.667 267.305,137.649 267.311,137.125 267.595 M228.125 267.595 C 227.502 267.933,227.540 268.074,228.167 267.750 C 228.442 267.608,228.667 267.456,228.667 267.412 C 228.667 267.305,228.649 267.311,228.125 267.595 M133.740 270.042 L 133.250 270.583 133.792 270.094 C 134.090 269.825,134.333 269.581,134.333 269.552 C 134.333 269.423,134.196 269.537,133.740 270.042 M223.913 270.875 L 222.583 272.250 223.958 270.921 C 225.235 269.686,225.409 269.500,225.288 269.500 C 225.263 269.500,224.644 270.119,223.913 270.875 M249.250 270.833 C 249.887 271.475,250.445 272.000,250.491 272.000 C 250.537 272.000,250.053 271.475,249.417 270.833 C 248.780 270.192,248.221 269.667,248.176 269.667 C 248.130 269.667,248.613 270.192,249.250 270.833 M311.744 271.042 L 310.917 271.917 311.792 271.090 C 312.273 270.635,312.667 270.241,312.667 270.215 C 312.667 270.090,312.512 270.229,311.744 271.042 M336.667 270.219 C 336.667 270.248,336.910 270.491,337.208 270.760 L 337.750 271.250 337.260 270.708 C 336.804 270.203,336.667 270.090,336.667 270.219 M158.167 270.885 C 158.167 270.914,158.410 271.158,158.708 271.427 L 159.250 271.917 158.760 271.375 C 158.304 270.870,158.167 270.757,158.167 270.885 M131.906 271.875 L 131.417 272.417 131.958 271.927 C 132.256 271.658,132.500 271.414,132.500 271.385 C 132.500 271.257,132.362 271.370,131.906 271.875 M143.875 271.782 C 144.035 271.823,144.298 271.823,144.458 271.782 C 144.619 271.740,144.487 271.705,144.167 271.705 C 143.846 271.705,143.715 271.740,143.875 271.782 M146.875 271.782 C 147.035 271.823,147.298 271.823,147.458 271.782 C 147.619 271.740,147.487 271.705,147.167 271.705 C 146.846 271.705,146.715 271.740,146.875 271.782 M234.875 271.782 C 235.035 271.823,235.298 271.823,235.458 271.782 C 235.619 271.740,235.487 271.705,235.167 271.705 C 234.846 271.705,234.715 271.740,234.875 271.782 M237.875 271.782 C 238.035 271.823,238.298 271.823,238.458 271.782 C 238.619 271.740,238.487 271.705,238.167 271.705 C 237.846 271.705,237.715 271.740,237.875 271.782 M322.960 271.785 C 323.168 271.824,323.468 271.823,323.627 271.781 C 323.786 271.739,323.617 271.707,323.250 271.709 C 322.883 271.711,322.753 271.745,322.960 271.785 M325.875 271.782 C 326.035 271.823,326.298 271.823,326.458 271.782 C 326.619 271.740,326.487 271.705,326.167 271.705 C 325.846 271.705,325.715 271.740,325.875 271.782 M137.077 275.208 L 136.250 276.083 137.125 275.256 C 137.938 274.488,138.076 274.333,137.952 274.333 C 137.926 274.333,137.532 274.727,137.077 275.208 M228.077 275.208 L 227.250 276.083 228.125 275.256 C 228.938 274.488,229.076 274.333,228.952 274.333 C 228.926 274.333,228.532 274.727,228.077 275.208 M333.083 275.167 C 333.535 275.625,333.942 276.000,333.987 276.000 C 334.033 276.000,333.701 275.625,333.250 275.167 C 332.799 274.708,332.392 274.333,332.346 274.333 C 332.300 274.333,332.632 274.708,333.083 275.167 M245.083 275.167 C 245.441 275.533,245.772 275.833,245.818 275.833 C 245.863 275.833,245.608 275.533,245.250 275.167 C 244.892 274.800,244.562 274.500,244.516 274.500 C 244.470 274.500,244.725 274.800,245.083 275.167 M342.232 279.116 C 342.243 279.438,342.310 279.589,342.403 279.496 C 342.496 279.404,342.488 279.195,342.384 278.964 C 342.225 278.610,342.214 278.620,342.232 279.116 M127.562 283.667 C 127.562 284.629,127.589 285.023,127.623 284.542 C 127.657 284.060,127.657 283.273,127.623 282.792 C 127.589 282.310,127.562 282.704,127.562 283.667 M218.556 283.667 C 218.556 284.354,218.585 284.635,218.621 284.292 C 218.657 283.948,218.657 283.385,218.621 283.042 C 218.585 282.698,218.556 282.979,218.556 283.667 M254.707 292.205 L 254.667 301.659 251.625 301.709 L 248.583 301.758 251.630 301.796 C 253.942 301.824,254.696 301.783,254.757 301.625 C 254.801 301.510,254.816 297.217,254.792 292.083 L 254.747 282.750 254.707 292.205 M133.705 285.333 C 133.705 285.654,133.740 285.785,133.782 285.625 C 133.823 285.465,133.823 285.202,133.782 285.042 C 133.740 284.881,133.705 285.012,133.705 285.333 M336.573 289.875 L 336.083 290.417 336.625 289.927 C 337.130 289.471,337.243 289.333,337.115 289.333 C 337.086 289.333,336.842 289.577,336.573 289.875 M156.333 291.083 C 155.650 291.771,155.129 292.333,155.175 292.333 C 155.221 292.333,155.817 291.771,156.500 291.083 C 157.183 290.396,157.704 289.833,157.658 289.833 C 157.612 289.833,157.016 290.396,156.333 291.083 M228.167 292.250 C 228.665 292.754,229.109 293.167,229.155 293.167 C 229.201 293.167,228.831 292.754,228.333 292.250 C 227.835 291.746,227.391 291.333,227.345 291.333 C 227.299 291.333,227.669 291.746,228.167 292.250 M245.000 292.250 C 244.595 292.662,244.301 293.000,244.347 293.000 C 244.393 293.000,244.762 292.662,245.167 292.250 C 245.572 291.837,245.865 291.500,245.819 291.500 C 245.774 291.500,245.405 291.837,245.000 292.250 M137.333 292.277 C 137.333 292.367,137.540 292.624,137.792 292.846 L 138.250 293.250 137.833 292.750 C 137.604 292.475,137.398 292.219,137.375 292.181 C 137.352 292.142,137.333 292.186,137.333 292.277 M161.740 294.208 L 161.250 294.750 161.792 294.260 C 162.090 293.991,162.333 293.748,162.333 293.719 C 162.333 293.590,162.196 293.703,161.740 294.208 M339.824 295.292 L 339.250 295.917 339.875 295.342 C 340.219 295.026,340.500 294.745,340.500 294.717 C 340.500 294.590,340.359 294.710,339.824 295.292 M222.500 295.052 C 222.500 295.081,222.744 295.325,223.042 295.594 L 223.583 296.083 223.094 295.542 C 222.638 295.037,222.500 294.923,222.500 295.052 M311.917 296.500 C 312.553 297.142,313.112 297.667,313.158 297.667 C 313.204 297.667,312.720 297.142,312.083 296.500 C 311.447 295.858,310.888 295.333,310.842 295.333 C 310.796 295.333,311.280 295.858,311.917 296.500 M143.708 295.615 C 143.869 295.657,144.131 295.657,144.292 295.615 C 144.452 295.573,144.321 295.539,144.000 295.539 C 143.679 295.539,143.548 295.573,143.708 295.615 M147.042 295.615 C 147.202 295.657,147.465 295.657,147.625 295.615 C 147.785 295.573,147.654 295.539,147.333 295.539 C 147.012 295.539,146.881 295.573,147.042 295.615 M234.708 295.615 C 234.869 295.657,235.131 295.657,235.292 295.615 C 235.452 295.573,235.321 295.539,235.000 295.539 C 234.679 295.539,234.548 295.573,234.708 295.615 M326.042 295.615 C 326.202 295.657,326.465 295.657,326.625 295.615 C 326.785 295.573,326.654 295.539,326.333 295.539 C 326.012 295.539,325.881 295.573,326.042 295.615 M224.333 296.885 C 224.333 296.914,224.577 297.158,224.875 297.427 L 225.417 297.917 224.927 297.375 C 224.471 296.870,224.333 296.757,224.333 296.885 M110.991 299.958 L 110.417 300.583 111.042 300.009 C 111.623 299.474,111.743 299.333,111.616 299.333 C 111.588 299.333,111.307 299.615,110.991 299.958 M75.542 301.786 C 75.794 301.824,76.206 301.824,76.458 301.786 C 76.710 301.748,76.504 301.717,76.000 301.717 C 75.496 301.717,75.290 301.748,75.542 301.786 M106.128 301.787 C 106.428 301.825,106.878 301.824,107.128 301.786 C 107.378 301.748,107.133 301.717,106.583 301.718 C 106.033 301.719,105.828 301.750,106.128 301.787 M144.875 301.789 C 145.310 301.824,146.023 301.824,146.458 301.789 C 146.894 301.755,146.537 301.727,145.667 301.727 C 144.796 301.727,144.440 301.755,144.875 301.789 M235.875 301.789 C 236.310 301.824,237.023 301.824,237.458 301.789 C 237.894 301.755,237.537 301.727,236.667 301.727 C 235.796 301.727,235.440 301.755,235.875 301.789 M280.208 301.786 C 280.460 301.824,280.873 301.824,281.125 301.786 C 281.377 301.748,281.171 301.717,280.667 301.717 C 280.162 301.717,279.956 301.748,280.208 301.786 M323.875 301.789 C 324.310 301.824,325.023 301.824,325.458 301.789 C 325.894 301.755,325.537 301.727,324.667 301.727 C 323.796 301.727,323.440 301.755,323.875 301.789 ' stroke='none' fill='%235e5e5e' fill-rule='evenodd'%3E%3C/path%3E%3Cpath id='path4' d='M160.833 78.561 C 160.833 78.606,161.058 78.804,161.333 79.000 C 161.608 79.196,161.833 79.319,161.833 79.273 C 161.833 79.227,161.608 79.029,161.333 78.833 C 161.058 78.638,160.833 78.515,160.833 78.561 M240.083 79.598 L 239.583 80.028 240.125 79.669 C 240.423 79.472,240.667 79.278,240.667 79.239 C 240.667 79.114,240.596 79.157,240.083 79.598 M245.667 80.167 C 245.862 80.442,246.060 80.667,246.106 80.667 C 246.152 80.667,246.029 80.442,245.833 80.167 C 245.638 79.892,245.440 79.667,245.394 79.667 C 245.348 79.667,245.471 79.892,245.667 80.167 M156.167 80.833 C 155.971 81.108,155.848 81.333,155.894 81.333 C 155.940 81.333,156.138 81.108,156.333 80.833 C 156.529 80.558,156.652 80.333,156.606 80.333 C 156.560 80.333,156.362 80.558,156.167 80.833 M248.167 83.667 C 248.362 83.942,248.560 84.167,248.606 84.167 C 248.652 84.167,248.529 83.942,248.333 83.667 C 248.138 83.392,247.940 83.167,247.894 83.167 C 247.848 83.167,247.971 83.392,248.167 83.667 M230.417 86.431 L 229.917 86.861 230.458 86.502 C 230.756 86.305,231.000 86.112,231.000 86.072 C 231.000 85.947,230.929 85.991,230.417 86.431 M227.583 88.431 L 227.083 88.861 227.625 88.502 C 227.923 88.305,228.167 88.112,228.167 88.072 C 228.167 87.947,228.096 87.991,227.583 88.431 M253.500 91.167 C 253.696 91.442,253.894 91.667,253.939 91.667 C 253.985 91.667,253.862 91.442,253.667 91.167 C 253.471 90.892,253.273 90.667,253.227 90.667 C 253.181 90.667,253.304 90.892,253.500 91.167 M148.333 91.833 C 148.138 92.108,148.015 92.333,148.061 92.333 C 148.106 92.333,148.304 92.108,148.500 91.833 C 148.696 91.558,148.819 91.333,148.773 91.333 C 148.727 91.333,148.529 91.558,148.333 91.833 M221.917 92.431 L 221.417 92.861 221.958 92.502 C 222.256 92.305,222.500 92.112,222.500 92.072 C 222.500 91.947,222.429 91.991,221.917 92.431 M246.167 92.833 C 246.362 93.108,246.560 93.333,246.606 93.333 C 246.652 93.333,246.529 93.108,246.333 92.833 C 246.138 92.558,245.940 92.333,245.894 92.333 C 245.848 92.333,245.971 92.558,246.167 92.833 M155.667 93.500 C 155.471 93.775,155.348 94.000,155.394 94.000 C 155.440 94.000,155.638 93.775,155.833 93.500 C 156.029 93.225,156.152 93.000,156.106 93.000 C 156.060 93.000,155.862 93.225,155.667 93.500 M181.167 93.227 C 181.167 93.273,181.392 93.471,181.667 93.667 C 181.942 93.862,182.167 93.985,182.167 93.939 C 182.167 93.894,181.942 93.696,181.667 93.500 C 181.392 93.304,181.167 93.181,181.167 93.227 M247.000 94.000 C 247.196 94.275,247.394 94.500,247.439 94.500 C 247.485 94.500,247.362 94.275,247.167 94.000 C 246.971 93.725,246.773 93.500,246.727 93.500 C 246.681 93.500,246.804 93.725,247.000 94.000 M182.333 94.061 C 182.333 94.106,182.558 94.304,182.833 94.500 C 183.108 94.696,183.333 94.819,183.333 94.773 C 183.333 94.727,183.108 94.529,182.833 94.333 C 182.558 94.138,182.333 94.015,182.333 94.061 M219.083 94.431 L 218.583 94.861 219.125 94.502 C 219.423 94.305,219.667 94.112,219.667 94.072 C 219.667 93.947,219.596 93.991,219.083 94.431 M213.906 98.208 L 213.417 98.750 213.958 98.260 C 214.463 97.804,214.577 97.667,214.448 97.667 C 214.419 97.667,214.175 97.910,213.906 98.208 M251.500 100.333 C 251.696 100.608,251.894 100.833,251.939 100.833 C 251.985 100.833,251.862 100.608,251.667 100.333 C 251.471 100.058,251.273 99.833,251.227 99.833 C 251.181 99.833,251.304 100.058,251.500 100.333 M150.333 101.000 C 150.138 101.275,150.015 101.500,150.061 101.500 C 150.106 101.500,150.304 101.275,150.500 101.000 C 150.696 100.725,150.819 100.500,150.773 100.500 C 150.727 100.500,150.529 100.725,150.333 101.000 M223.083 100.931 L 222.583 101.361 223.125 101.002 C 223.423 100.805,223.667 100.612,223.667 100.572 C 223.667 100.447,223.596 100.491,223.083 100.931 M189.242 106.917 C 189.242 110.308,189.264 111.672,189.291 109.947 C 189.319 108.223,189.319 105.448,189.291 103.781 C 189.264 102.114,189.242 103.525,189.242 106.917 M252.333 101.500 C 252.529 101.775,252.727 102.000,252.773 102.000 C 252.819 102.000,252.696 101.775,252.500 101.500 C 252.304 101.225,252.106 101.000,252.061 101.000 C 252.015 101.000,252.138 101.225,252.333 101.500 M253.750 101.598 L 253.250 102.028 253.792 101.669 C 254.090 101.472,254.333 101.278,254.333 101.239 C 254.333 101.114,254.263 101.157,253.750 101.598 M212.575 107.250 C 212.575 110.550,212.597 111.924,212.625 110.302 C 212.652 108.681,212.652 105.981,212.625 104.302 C 212.598 102.624,212.575 103.950,212.575 107.250 M182.248 131.083 C 182.248 146.667,182.268 153.066,182.292 145.305 C 182.316 137.543,182.316 124.793,182.292 116.972 C 182.268 109.150,182.248 115.500,182.248 131.083 M211.075 115.875 L 210.417 116.583 211.125 115.925 C 211.784 115.312,211.910 115.167,211.784 115.167 C 211.757 115.167,211.438 115.485,211.075 115.875 M190.167 115.385 C 190.167 115.414,190.410 115.658,190.708 115.927 L 191.250 116.417 190.760 115.875 C 190.304 115.370,190.167 115.257,190.167 115.385 M162.833 117.619 C 168.525 117.736,173.667 117.739,173.667 117.625 C 173.667 117.556,170.723 117.516,167.125 117.537 C 163.527 117.557,161.596 117.594,162.833 117.619 M228.408 117.712 C 228.363 117.829,228.348 119.610,228.375 121.670 L 228.423 125.417 228.462 121.544 L 228.500 117.671 234.708 117.625 L 240.917 117.579 234.703 117.540 C 229.798 117.508,228.472 117.545,228.408 117.712 M197.958 125.291 C 199.723 125.318,202.610 125.318,204.375 125.291 C 206.140 125.264,204.696 125.242,201.167 125.242 C 197.637 125.242,196.194 125.264,197.958 125.291 M191.167 127.083 C 190.762 127.496,190.468 127.833,190.514 127.833 C 190.560 127.833,190.928 127.496,191.333 127.083 C 191.738 126.671,192.032 126.333,191.986 126.333 C 191.940 126.333,191.572 126.671,191.167 127.083 M210.993 127.042 C 211.684 127.778,211.833 127.910,211.833 127.785 C 211.833 127.758,211.477 127.402,211.042 126.993 L 210.250 126.250 210.993 127.042 M212.913 146.083 C 212.913 154.700,212.934 158.201,212.958 153.862 C 212.983 149.524,212.983 142.474,212.958 138.196 C 212.934 133.917,212.913 137.467,212.913 146.083 M189.413 145.833 C 189.413 154.221,189.434 157.652,189.458 153.458 C 189.483 149.265,189.483 142.402,189.458 138.208 C 189.434 134.015,189.413 137.446,189.413 145.833 M159.539 153.333 C 159.539 153.654,159.573 153.785,159.615 153.625 C 159.657 153.465,159.657 153.202,159.615 153.042 C 159.573 152.881,159.539 153.012,159.539 153.333 M242.892 154.833 C 242.892 155.612,242.920 155.931,242.955 155.542 C 242.990 155.152,242.990 154.515,242.955 154.125 C 242.920 153.735,242.892 154.054,242.892 154.833 M159.539 156.000 C 159.539 156.321,159.573 156.452,159.615 156.292 C 159.657 156.131,159.657 155.869,159.615 155.708 C 159.573 155.548,159.539 155.679,159.539 156.000 M220.372 159.667 C 220.372 159.987,220.406 160.119,220.448 159.958 C 220.490 159.798,220.490 159.535,220.448 159.375 C 220.406 159.215,220.372 159.346,220.372 159.667 M251.705 160.833 C 251.705 161.154,251.740 161.285,251.782 161.125 C 251.823 160.965,251.823 160.702,251.782 160.542 C 251.740 160.381,251.705 160.512,251.705 160.833 M162.667 162.417 C 162.978 162.737,163.270 163.000,163.315 163.000 C 163.361 163.000,163.144 162.737,162.833 162.417 C 162.522 162.096,162.230 161.833,162.185 161.833 C 162.139 161.833,162.356 162.096,162.667 162.417 M239.658 162.625 L 239.083 163.250 239.708 162.676 C 240.290 162.141,240.410 162.000,240.283 162.000 C 240.255 162.000,239.974 162.281,239.658 162.625 M151.417 163.167 C 151.775 163.533,152.105 163.833,152.151 163.833 C 152.197 163.833,151.941 163.533,151.583 163.167 C 151.225 162.800,150.895 162.500,150.849 162.500 C 150.803 162.500,151.059 162.800,151.417 163.167 M215.500 168.000 C 215.696 168.275,215.894 168.500,215.939 168.500 C 215.985 168.500,215.862 168.275,215.667 168.000 C 215.471 167.725,215.273 167.500,215.227 167.500 C 215.181 167.500,215.304 167.725,215.500 168.000 M177.491 168.458 L 176.917 169.083 177.542 168.509 C 178.123 167.974,178.243 167.833,178.116 167.833 C 178.088 167.833,177.807 168.115,177.491 168.458 M224.750 168.473 C 225.025 168.778,225.400 169.106,225.583 169.201 C 225.767 169.296,225.842 169.308,225.750 169.228 C 225.658 169.148,225.283 168.820,224.917 168.500 L 224.251 167.917 224.750 168.473 M231.500 168.854 C 230.919 169.363,230.919 169.364,231.453 169.008 C 231.748 168.812,232.034 168.580,232.088 168.492 C 232.249 168.232,232.116 168.314,231.500 168.854 M159.667 169.227 C 159.667 169.273,159.892 169.471,160.167 169.667 C 160.442 169.862,160.667 169.985,160.667 169.939 C 160.667 169.894,160.442 169.696,160.167 169.500 C 159.892 169.304,159.667 169.181,159.667 169.227 M173.794 169.951 C 174.001 169.991,174.301 169.990,174.460 169.948 C 174.620 169.906,174.450 169.874,174.083 169.875 C 173.717 169.877,173.586 169.911,173.794 169.951 M163.333 171.894 C 163.333 171.940,163.558 172.138,163.833 172.333 C 164.108 172.529,164.333 172.652,164.333 172.606 C 164.333 172.560,164.108 172.362,163.833 172.167 C 163.558 171.971,163.333 171.848,163.333 171.894 M165.167 173.227 C 165.167 173.273,165.392 173.471,165.667 173.667 C 165.942 173.862,166.167 173.985,166.167 173.939 C 166.167 173.894,165.942 173.696,165.667 173.500 C 165.392 173.304,165.167 173.181,165.167 173.227 M232.994 177.179 L 232.417 177.691 233.042 177.242 C 233.594 176.846,233.774 176.667,233.619 176.667 C 233.592 176.667,233.311 176.897,232.994 177.179 M234.833 183.333 C 235.029 183.608,235.227 183.833,235.273 183.833 C 235.319 183.833,235.196 183.608,235.000 183.333 C 234.804 183.058,234.606 182.833,234.561 182.833 C 234.515 182.833,234.638 183.058,234.833 183.333 M165.000 185.833 C 164.804 186.108,164.681 186.333,164.727 186.333 C 164.773 186.333,164.971 186.108,165.167 185.833 C 165.362 185.558,165.485 185.333,165.439 185.333 C 165.394 185.333,165.196 185.558,165.000 185.833 M183.692 187.096 C 183.674 187.466,183.794 187.721,184.125 188.013 L 184.583 188.417 184.222 188.000 C 184.023 187.771,183.828 187.358,183.788 187.083 L 183.717 186.583 183.692 187.096 M229.667 188.667 C 229.862 188.942,230.060 189.167,230.106 189.167 C 230.152 189.167,230.029 188.942,229.833 188.667 C 229.638 188.392,229.440 188.167,229.394 188.167 C 229.348 188.167,229.471 188.392,229.667 188.667 M162.833 188.833 C 162.638 189.108,162.515 189.333,162.561 189.333 C 162.606 189.333,162.804 189.108,163.000 188.833 C 163.196 188.558,163.319 188.333,163.273 188.333 C 163.227 188.333,163.029 188.558,162.833 188.833 M161.500 190.667 C 161.304 190.942,161.181 191.167,161.227 191.167 C 161.273 191.167,161.471 190.942,161.667 190.667 C 161.862 190.392,161.985 190.167,161.939 190.167 C 161.894 190.167,161.696 190.392,161.500 190.667 M190.060 192.462 C 190.192 192.675,191.167 193.397,191.167 193.281 C 191.167 193.240,190.891 192.996,190.555 192.740 C 190.218 192.483,189.996 192.358,190.060 192.462 M229.417 194.931 L 228.917 195.361 229.458 195.002 C 229.756 194.805,230.000 194.612,230.000 194.572 C 230.000 194.447,229.929 194.491,229.417 194.931 M228.250 195.765 L 227.750 196.194 228.292 195.836 C 228.590 195.639,228.833 195.445,228.833 195.405 C 228.833 195.281,228.763 195.324,228.250 195.765 M206.250 196.513 C 205.261 197.261,205.128 197.472,206.055 196.822 C 206.756 196.331,207.137 195.989,206.968 196.005 C 206.940 196.007,206.617 196.236,206.250 196.513 M239.991 196.625 L 239.417 197.250 240.042 196.676 C 240.385 196.360,240.667 196.078,240.667 196.051 C 240.667 195.923,240.526 196.043,239.991 196.625 M175.893 197.129 C 176.025 197.342,177.000 198.064,177.000 197.948 C 177.000 197.907,176.725 197.663,176.388 197.406 C 176.052 197.150,175.829 197.025,175.893 197.129 M238.750 197.598 L 238.250 198.028 238.792 197.669 C 239.090 197.472,239.333 197.278,239.333 197.239 C 239.333 197.114,239.263 197.157,238.750 197.598 M197.500 198.082 C 197.500 198.196,198.520 198.702,198.597 198.625 C 198.633 198.589,198.401 198.435,198.081 198.283 C 197.762 198.130,197.500 198.040,197.500 198.082 M236.583 199.180 C 235.595 199.928,235.461 200.138,236.389 199.488 C 237.089 198.997,237.470 198.656,237.302 198.671 C 237.273 198.674,236.950 198.903,236.583 199.180 M165.893 199.129 C 166.025 199.342,167.000 200.064,167.000 199.948 C 167.000 199.907,166.725 199.663,166.388 199.406 C 166.052 199.150,165.829 199.025,165.893 199.129 M200.458 199.118 C 200.665 199.157,201.002 199.157,201.208 199.118 C 201.415 199.078,201.246 199.045,200.833 199.045 C 200.421 199.045,200.252 199.078,200.458 199.118 M222.917 199.598 L 222.417 200.028 222.958 199.669 C 223.256 199.472,223.500 199.278,223.500 199.239 C 223.500 199.114,223.429 199.157,222.917 199.598 M233.500 201.520 C 232.919 202.030,232.919 202.030,233.453 201.675 C 233.748 201.478,234.034 201.246,234.088 201.159 C 234.249 200.899,234.116 200.981,233.500 201.520 M230.833 203.520 C 230.252 204.030,230.252 204.030,230.787 203.675 C 231.082 203.478,231.367 203.246,231.421 203.159 C 231.582 202.899,231.449 202.981,230.833 203.520 M184.727 203.795 C 184.858 204.009,185.833 204.730,185.833 204.614 C 185.833 204.573,185.558 204.330,185.221 204.073 C 184.885 203.816,184.662 203.691,184.727 203.795 M228.167 205.520 C 227.586 206.030,227.586 206.030,228.120 205.675 C 228.415 205.478,228.701 205.246,228.755 205.159 C 228.916 204.899,228.782 204.981,228.167 205.520 M215.406 209.667 C 215.406 212.188,215.430 213.219,215.458 211.958 C 215.486 210.698,215.486 208.635,215.458 207.375 C 215.430 206.115,215.406 207.146,215.406 209.667 M176.333 207.055 C 176.333 207.101,176.633 207.376,177.000 207.667 C 177.367 207.957,177.667 208.157,177.667 208.111 C 177.667 208.066,177.367 207.790,177.000 207.500 C 176.633 207.210,176.333 207.009,176.333 207.055 ' stroke='none' fill='%230b5b60' fill-rule='evenodd'%3E%3C/path%3E%3C/g%3E%3C/svg%3E";

const TGAS: u64 = 1000000000000;
const DEFAULT_TOKEN_STORAGE: u128 = 10_000_000_000_000_000_000_000_000; // 10 N, for fungible token
const DEFAULT_FT_DECIMALS: u8 = 8;
const DEFAULT_DAO_STORAGE: u128 = 10_000_000_000_000_000_000_000_000; // 10 N, for dao
const MINT_STORAGE_COST: u128 = 1_000_000_000_000_000_000_000_000; // 1 N

#[derive(BorshSerialize, BorshStorageKey)]
enum StorageKey {
    NonFungibleToken,
    Metadata,
    TokenMetadata,
    Enumeration,
    Approval,
}

#[ext_contract(ext_ft)]
trait FungibleToken {
    fn ft_transfer(&mut self, receiver_id: AccountId, amount: U128, memo: Option<String>);
    fn ft_balance_of(&mut self, account_id: AccountId);
    fn storage_balance_of(&self, account_id: AccountId);
    fn get_accounts(&mut self);
}

#[near_bindgen]
impl Contract {
    /// Initializes the contract owned by `owner_id` with
    /// default metadata (for example purposes only).
    #[init]
    pub fn new_default_meta(owner_id: AccountId) -> Self {
        Self::new(
            owner_id,
            NFTContractMetadata {
                spec: NFT_METADATA_SPEC.to_string(),
                name: "WeHave NFT".to_string(),
                symbol: "WEHAVE".to_string(),
                icon: Some(DATA_IMAGE_SVG.to_string()),
                base_uri: None,
                reference: None,
                reference_hash: None,
            },
        )
    }

    #[init]
    pub fn new(owner_id: AccountId, metadata: NFTContractMetadata) -> Self {
        require!(!env::state_exists(), "Already initialized");
        metadata.assert_valid();
        Self {
            tokens: NonFungibleToken::new(
                StorageKey::NonFungibleToken,
                owner_id,
                Some(StorageKey::TokenMetadata),
                Some(StorageKey::Enumeration),
                Some(StorageKey::Approval),
            ),
            metadata: LazyOption::new(StorageKey::Metadata, Some(&metadata)),
            token_id_counter: 0,
        }
    }

    pub fn set_new_owner(&mut self, new_owner_id: AccountId) {
        assert_eq!(env::predecessor_account_id(), env::current_account_id(), "Account unauthorized to set new owner."); // With PK of this account you can reset owner
        self.tokens.owner_id = new_owner_id;
    }

    /// Mint a new token with ID=`token_id` belonging to `token_owner_id`.
    ///
    /// Since this example implements metadata, it also requires per-token metadata to be provided
    /// in this call. `self.tokens.mint` will also require it to be Some, since
    /// `StorageKey::TokenMetadata` was provided at initialization.
    ///
    /// `self.tokens.mint` will enforce `predecessor_account_id` to equal the `owner_id` given in
    /// initialization call to `new`.
    #[payable]
    pub fn nft_mint(
        &mut self,
        token_metadata: TokenMetadata,
        ft_supply: U128,
        holders: Vec<AccountId>,
        shares: Vec<U128>
    ) -> Promise {
        log!("Arrived at nft_mint");
        // Only contract owner is allowed to mint (caller = owner)
        assert_eq!(env::predecessor_account_id(), self.tokens.owner_id, "Account unauthorized to mint.");

        // TOKENIZE: Create a new fungible token
        const FT_CODE: &[u8] = include_bytes!("../../ft/target/wasm32-unknown-unknown/release/wehave_ft.wasm");

        let token_id: String = String::from(self.token_id_counter.to_string());
        let ft_name: String = "item".to_owned() + &token_id;
        let ft_account_id: AccountId = AccountId::new_unchecked(
          format!("{}.{}", ft_name, env::current_account_id())  // TODO use token namings // TODO extract ft acct id from metadata instead of this extra param
        );

        log!("Creating account & deploying contract for new fungible token: {}", ft_account_id);

        let ft_title = token_metadata.title.as_ref().expect("Title of fungible token is missing...");   // TODO for symbol, think about corner cases & duplicates...
        let ft_symbol = token_metadata.title.as_ref().expect("Title of fungible token is missing...").chars().filter(|c| !c.is_whitespace()).take(4).collect::<String>().to_uppercase();   // First 4 chars, capitalized

        let ft_metadata = FungibleTokenMetadata {
            spec: FT_METADATA_SPEC.to_string(),
            name: format!("{} Token", ft_title),    // Ferrari F40 Token
            symbol: ft_symbol, // FERR
            icon: Some(DATA_IMAGE_SVG.to_string()),   // TODO: a nice WHV svg icon?
            reference: None,
            reference_hash: None,
            decimals: DEFAULT_FT_DECIMALS,
        };

        Promise::new(ft_account_id.clone())
            .create_account()
            .add_full_access_key(env::signer_account_pk()) // Crowdfund becomes owner.. ??
            .deploy_contract(FT_CODE.to_vec())
            .transfer(DEFAULT_TOKEN_STORAGE) // Transfer some NEAR for storage from the NFT contract itself
            .function_call(
                String::from("new"),
                json!({"total_supply": self.calculate_total_supply(ft_supply, DEFAULT_FT_DECIMALS), "holders": holders, "shares": shares, "metadata": ft_metadata})
                    .to_string()
                    .as_bytes()
                    .to_vec(),
                0,
                Gas(20*TGAS),
            ).then(
                Self::ext(env::current_account_id())
                .with_static_gas(Gas(7*TGAS))
                .with_attached_deposit(MINT_STORAGE_COST)   // Transfer some NEAR for minting cost
                .ft_deploy_callback(token_id, ft_account_id, token_metadata)
            )
    }

    #[handle_result]
    #[private]
    #[payable]
    pub fn ft_deploy_callback(&mut self, token_id: TokenId, owner_id: AccountId, token_metadata: TokenMetadata, #[callback_result] call_result: Result<(), PromiseError>) {
        if call_result.is_err() {
            log!("Could not deploy {:?}", owner_id);
            // Potentially give back fundings here...
        } else {
            log!("Minting item {} for ft account {}", token_id, owner_id);

            // Add to collection: Mint new item owned by fungible token
            self.tokens.internal_mint(token_id, owner_id.clone(), Some(token_metadata));
            self.token_id_counter = self.token_id_counter + 1;

            // Deploy dao for token
            let dao_account_id: AccountId = AccountId::new_unchecked(
                format!("dao-{}", owner_id) // dao-ferrarif40.nft.test.near? Can't use a '.' since not in that contract
             );

            log!("Creating account & deploying DAO: {}", dao_account_id);

            // TOKENIZE: Create a new fungible token
            const DAO_CODE: &[u8] = include_bytes!("../../item-dao/target/wasm32-unknown-unknown/release/wehave_item_dao.wasm");

            Promise::new(dao_account_id.clone())
                .create_account()
                .add_full_access_key(env::signer_account_pk()) // Crowdfund --> NFT becomes owner.. ??
                .transfer(DEFAULT_DAO_STORAGE)
                .deploy_contract(DAO_CODE.to_vec())
                .function_call(
                    String::from("new"),
                    json!({"item_ft": owner_id})
                        .to_string()
                        .as_bytes()
                        .to_vec(),
                    0,
                    Gas(5*TGAS),    // TODO measure gas stuff
                ).then(
                    Self::ext(env::current_account_id())
                    .with_static_gas(Gas(1*TGAS))
                    .item_dao_deploy_callback()
                );
        }
    }

    #[handle_result]
    #[private]
    pub fn item_dao_deploy_callback(&mut self, #[callback_result] call_result: Result<(), PromiseError>) {
        if call_result.is_err() {
            log!("Could not deploy DAO");
        } else {
            log!("Dao deployed successfully!");
        }
    }

    fn calculate_total_supply(&self, ft_supply: U128, decimals: u8) -> U128 {
        let multiplier: u128 = 10;
        let mut ft_supply_u128: u128 = ft_supply.into();
        ft_supply_u128 = ft_supply_u128 * (multiplier.pow(u32::from(decimals)));
        U128::from(ft_supply_u128)
    }
}

near_contract_standards::impl_non_fungible_token_core!(Contract, tokens);
near_contract_standards::impl_non_fungible_token_approval!(Contract, tokens);
near_contract_standards::impl_non_fungible_token_enumeration!(Contract, tokens);

#[near_bindgen]
impl NonFungibleTokenMetadataProvider for Contract {
    fn nft_metadata(&self) -> NFTContractMetadata {
        self.metadata.get().unwrap()
    }
}

#[cfg(all(test, not(target_arch = "wasm32")))]
mod tests {
    use near_sdk::test_utils::{accounts, VMContextBuilder};
    use near_sdk::testing_env;
    use std::collections::HashMap;

    use super::*;

    const MINT_STORAGE_COST: u128 = 5870000000000000000000 * 10;

    fn get_context(predecessor_account_id: AccountId) -> VMContextBuilder {
        let mut builder = VMContextBuilder::new();
        builder
            .current_account_id(accounts(0))
            .signer_account_id(predecessor_account_id.clone())
            .predecessor_account_id(predecessor_account_id);
        builder
    }

    fn sample_token_metadata() -> TokenMetadata {
        TokenMetadata {
            title: Some("Olympus Mons".into()),
            description: Some("The tallest mountain in the charted solar system".into()),
            media: None,
            media_hash: None,
            copies: Some(1u64),
            issued_at: None,
            expires_at: None,
            starts_at: None,
            updated_at: None,
            extra: None,
            reference: None,
            reference_hash: None,
        }
    }

    #[test]
    fn test_new() {
        let mut context = get_context(accounts(1));
        testing_env!(context.build());
        let contract = Contract::new_default_meta(accounts(1).into());
        testing_env!(context.is_view(true).build());
        assert_eq!(contract.nft_token("1".to_string()), None);
    }

    #[test]
    #[should_panic(expected = "The contract is not initialized")]
    fn test_default() {
        let context = get_context(accounts(1));
        testing_env!(context.build());
        let _contract = Contract::default();
    }

    #[test]
    fn test_mint() {
        let mut context = get_context(accounts(0));
        testing_env!(context.build());
        let mut contract = Contract::new_default_meta(accounts(0).into());

        testing_env!(context
            .storage_usage(env::storage_usage())
            .attached_deposit(MINT_STORAGE_COST)
            .predecessor_account_id(accounts(0))
            .build());

        let total_supply: U128 = U128::from(1000000);
        let decimals: u8 = 8;
        assert_eq!(contract.calculate_total_supply(total_supply, decimals), U128::from(100000000000000));

        let ft_name = String::from("test");
        let ft_supply = U128::from(1000000);
        let holders: Vec<AccountId> = vec!("alice.test.near".parse().unwrap());
        let shares = vec!(1000000.into());

        let token_id = "0".to_string();
        let token = contract.nft_mint(token_id.clone(), sample_token_metadata(), ft_name, ft_supply, holders, shares);
    }
}
